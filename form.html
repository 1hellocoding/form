<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Add Gig | My Bands Tonight</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-right: env(safe-area-inset-right, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --safe-left: env(safe-area-inset-left, 0px);
        }
        *, *::before, *::after { box-sizing: border-box; }
        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f8fafc; /* bg-slate-50 */
        }

        #app-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            background-color: #f8fafc;
        }

        main {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-top: var(--safe-top);
            padding-left: var(--safe-left);
            padding-right: var(--safe-right);
        }

        /* Custom alert styling */
        #customAlert {
            position: fixed;
            top: calc(var(--safe-top) + 20px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            pointer-events: none;
        }
        .custom-alert-box {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white; padding: 1rem 1.5rem; border-radius: 0.75rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            font-weight: 500; opacity: 0;
            animation: slideDownFadeIn 0.4s ease-out forwards;
        }
        .custom-alert-box.fade-out {
            animation: slideUpFadeOut 0.4s ease-in forwards;
        }
        @keyframes slideDownFadeIn { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUpFadeOut { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-30px); opacity: 0; } }
        
        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(15, 23, 42, 0.5); /* slate-900/50 */
            backdrop-filter: blur(4px);
            z-index: 40000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        /* Custom Calendar Styles */
        .calendar {
            background: white; padding: 16px; border-radius: 13px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0; width: 320px;
        }
        .calendar-header {
            font-size: 1.12em; font-weight: 600; text-align: center;
            margin-bottom: 10px; display: flex; justify-content: space-between;
            align-items: center;
        }
        .calendar-header button {
            background: none; border: none; font-size: 1.2em;
            cursor: pointer; color: #4f46e5; user-select: none;
            padding: 0 8px; transition: color 0.2s;
        }
        .calendar-header button:hover { color: #3730a3; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-grid .day-label { text-align: center; font-size: 0.75em; font-weight: bold; color: #64748b; }
        .day {
            aspect-ratio: 1 / 1; width: 100%; max-width: 36px; margin: 0 auto;
            background: #f1f5f9; color: #334155; border-radius: 50%;
            cursor: pointer; font-size: 0.8em; transition: all 0.2s ease;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .day:hover { background: #e0e7ff; color: #3730a3; transform: scale(1.05); }
        .day.selected {
            background: linear-gradient(135deg, #4f46e5, #6366f1); color: white;
            font-weight: bold; box-shadow: 0 2px 8px rgba(79, 70, 229, 0.4);
            transform: scale(1.05);
        }
        .day.today {
            outline: 2px solid #a5b4fc; /* A lighter indigo for the outline */
            outline-offset: 2px;
        }
        .day.empty { background: transparent; cursor: default; }
        .day.disabled { background: #f8fafc; color: #cbd5e1; cursor: not-allowed; }

        /* Custom Time Picker Styles */
        .time-picker {
            background: white; padding: 24px; border-radius: 13px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0; width: 280px;
            text-align: center;
        }
        .time-picker-inputs { display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 2.5rem; font-weight: 600; color: #1e293b; }
        .time-picker-inputs input {
            width: 60px; text-align: center; border: none; background: #f1f5f9;
            border-radius: 8px; padding: 8px 0;
            font-size: inherit; font-weight: inherit; color: inherit;
        }
        .time-picker-inputs input:focus { outline: 2px solid #4f46e5; }
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .time-picker-ampm button {
            padding: 8px 16px; border: 2px solid #e2e8f0; border-radius: 8px;
            background: white; color: #475569; font-weight: 600;
            transition: all 0.2s ease;
        }
        .time-picker-ampm button.active {
            background: #4f46e5; color: white; border-color: #4f46e5;
        }

        /* --- Skeleton Loader Styles --- */
        .skeleton-item {
            padding: 0.5rem 1rem; /* Mimics px-4 py-2 */
            border-bottom: 1px solid #f1f5f9; /* slate-100 */
        }
        .skeleton-line {
            height: 0.875rem; /* ~14px height for text line */
            background-color: #e2e8f0; /* slate-200 */
            border-radius: 0.25rem; /* rounded-sm */
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .skeleton-line.long {
            width: 90%;
            margin-bottom: 0.5rem; /* Space between the two lines */
        }
        .skeleton-line.short {
            width: 60%;
        }
        @keyframes pulse {
            50% { opacity: .5; }
        }
        
        /* Bottom navigation styling */
        #bottom-nav { flex-shrink: 0; padding-left: var(--safe-left); padding-right: var(--safe-right); padding-bottom: var(--safe-bottom); }
        .hamburger-line { transition: all 0.3s ease-in-out; }
        .open .line-1 { transform: translateY(9px) rotate(45deg); }
        .open .line-2 { opacity: 0; transform: scaleX(0); }
        .open .line-3 { transform: translateY(-9px) rotate(-45deg); }

        /* Loading overlay styling */
        @keyframes shimmer { 100% { transform: translateX(100%); } }
        #loadingOverlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(249, 249, 249, 0.85); backdrop-filter: blur(5px); z-index: 30000; display: flex; justify-content: center; align-items: center; flex-direction: column; user-select: none; opacity: 1; transition: opacity 0.5s ease; }
        .loading-image-container { position: relative; width: 1000px; height: 500px; margin-bottom: 25px; filter: drop-shadow(2px 0 0 white) drop-shadow(-2px 0 0 white) drop-shadow(0 2px 0 white) drop-shadow(0 -2px 0 white); -webkit-mask-image: url('https://i.imghippo.com/files/ofc9438IXE.png'); mask-image: url('https://i.imghippo.com/files/ofc9438IXE.png'); -webkit-mask-size: contain; mask-size: contain; -webkit-mask-position: center; mask-position: center; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; }
        .loading-image-container::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(110deg, transparent 40%, rgba(255, 255, 255, 0.4) 50%, transparent 60%); transform: translateX(-100%); animation: shimmer 2.5s infinite linear; }
        .loading-image { width: 100%; height: 100%; object-fit: contain; display: block; }
        .loading-text { font-size: 1.5em; color: #3b82f6; font-weight: bold; letter-spacing: 2px; }
        @media (max-width: 768px) { .loading-image-container { width: 90vw; height: 45vw; } }

    </style>
</head>
<body>

<div id="app-container">
    <main>
        <div id="customAlert"></div>

        <div class="container mx-auto max-w-2xl px-4 pt-8 pb-12">
            <header class="text-center mb-10">
                <h1 class="text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">Add New Gigs</h1>
                <p class="mt-4 text-lg text-slate-600">Fill out the form and add one or more gigs to a list, then submit them all at once.</p>
            </header>
            
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-slate-200">
                <form id="gig-entry-form" novalidate>
                    <div class="space-y-6">
                        
                        <div>
                            <h2 class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4">Band Details</h2>
                            <div class="space-y-4">
                                <div class="space-y-2">
                                    <label for="band-name" class="text-sm font-medium text-slate-700">Name</label>
                                    <input type="text" id="band-name" required class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow" autocomplete="one-time-code">
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label for="band-website" class="text-sm font-medium text-slate-700">Band Website</label>
                                        <input type="url" id="band-website" placeholder="https://example.com" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow" autocomplete="one-time-code">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="band-email" class="text-sm font-medium text-slate-700">Band Email</label>
                                        <input type="email" id="band-email" placeholder="contact@example.com" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h2 class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4">Venue Details</h2>
                            <div class="space-y-4">
                                <div class="space-y-2">
                                    <label for="venue-name" class="text-sm font-medium text-slate-700">Venue Name</label>
                                    <div id="venue-container" class="relative">
                                        <input type="text" id="venue-name" required class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow" autocomplete="one-time-code">
                                        <div id="venue-suggestions" class="hidden absolute w-full bg-white border border-slate-300 rounded-lg mt-1 shadow-lg z-20 max-h-60 overflow-y-auto"></div>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label for="venue-address" class="text-sm font-medium text-slate-700">Address</label>
                                    <div id="address-container" class="relative">
                                        <input type="text" id="venue-address" required placeholder="Start typing an address..." class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow" autocomplete="one-time-code">
                                        <div id="address-suggestions" class="hidden absolute w-full bg-white border border-slate-300 rounded-lg mt-1 shadow-lg z-10 max-h-60 overflow-y-auto"></div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label for="venue-website" class="text-sm font-medium text-slate-700">Venue Website</label>
                                        <input type="url" id="venue-website" placeholder="https://venue.com" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow" autocomplete="one-time-code">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="venue-phone" class="text-sm font-medium text-slate-700">Venue Phone Number</label>
                                        <input type="tel" id="venue-phone" placeholder="(555) 123-4567" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label for="venue-email" class="text-sm font-medium text-slate-700">Venue Email</label>
                                    <input type="email" id="venue-email" placeholder="booking@venue.com" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">
                                </div>
                            </div>
                        </div>

                        <div>
                             <h2 class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4">Event Details</h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label for="gig-date-display" class="text-sm font-medium text-slate-700">Date</label>
                                    <div id="gig-date-display" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow cursor-pointer text-slate-700">Select a date...</div>
                                    <input type="hidden" id="gig-date" required>
                                </div>
                                <div class="space-y-2">
                                    <label for="gig-time-display" class="text-sm font-medium text-slate-700">Time</label>
                                    <div id="gig-time-display" class="w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow cursor-pointer text-slate-700">Select a time...</div>
                                    <input type="hidden" id="gig-time" required>
                                </div>
                            </div>
                        </div>

                        <div class="pt-2">
                            <h3 class="text-base font-semibold text-slate-800 mb-3">Autofill Options</h3>
                            <div class="flex items-center space-x-6 bg-slate-50 p-3 rounded-lg border border-slate-200">
                                <label for="keep-venue-info" class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="keep-venue-info" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="ml-2 text-sm text-slate-700 font-medium">Keep Venue Info</span>
                                </label>
                                <label for="keep-time" class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="keep-time" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="ml-2 text-sm text-slate-700 font-medium">Keep Time</span>
                                </label>
                            </div>
                        </div>

                        <div class="pt-4 space-y-4">
                            <button type="button" id="add-gig-to-list-btn" class="w-full py-3 px-5 bg-slate-600 text-white font-semibold rounded-lg shadow-md hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-opacity-75 transition-all transform hover:scale-105">
                                <i class="fas fa-plus mr-2"></i> Add Gig to List
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div id="staged-gigs-container" class="mt-8 hidden">
                <h2 class="text-2xl font-bold tracking-tight text-slate-900">Upcoming Gigs to Add</h2>
                <p class="mt-2 text-md text-slate-600">Review your gigs below. You can remove any before submitting.</p>
                <div id="staged-gigs-list" class="mt-4 space-y-3">
                </div>
                <div class="mt-6 flex flex-col sm:flex-row gap-4">
                    <button id="submit-all-btn" class="w-full sm:w-auto flex-grow py-3 px-5 bg-gradient-to-br from-blue-500 to-indigo-600 text-white font-semibold rounded-lg shadow-md hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition-all transform hover:scale-105">
                        Submit All Gigs
                    </button>
                    <button id="clear-list-btn" class="w-full sm:w-auto py-3 px-5 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition-all">
                        Clear List
                    </button>
                </div>
            </div>

        </div>
        <div id="calendar-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="calendar">
                    <div class="calendar-header">
                        <button id="prev-month-btn">&#8592;</button>
                        <div id="month-year-display"></div>
                        <button id="next-month-btn">&#8594;</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="day-label">Sun</div><div class="day-label">Mon</div><div class="day-label">Tue</div><div class="day-label">Wed</div><div class="day-label">Thu</div><div class="day-label">Fri</div><div class="day-label">Sat</div>
                    </div>
                    <div id="calendar-days-grid" class="calendar-grid"></div>
                </div>
            </div>
        </div>

        <div id="time-picker-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="time-picker">
                    <div class="time-picker-inputs">
                        <input type="number" id="time-hour" min="1" max="12" placeholder="8">
                        <span>:</span>
                        <input type="number" id="time-minute" min="0" max="59" placeholder="00">
                    </div>
                    <div class="time-picker-ampm mt-4 flex justify-center gap-2">
                        <button id="time-am" class="active">AM</button>
                        <button id="time-pm">PM</button>
                    </div>
                    <button id="set-time-btn" class="mt-6 w-full py-2 px-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition-all">
                        Set Time
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div id="bottom-nav" class="bg-white/95 backdrop-blur-md border-t border-gray-200">
        <div class="flex items-center w-full px-4 py-2 gap-4">
            <div class="flex flex-1 items-center justify-center gap-2 min-w-0">
                <a href="https://www.mybandstonight.com/bands-gallery" target="_top" class="flex-1 flex flex-col items-center justify-center text-blue-600 hover:bg-blue-50 py-2 rounded-xl transition-all duration-300">
                    <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                    <span class="text-xs font-bold text-center">Bands Gallery</span>
                </a>
                <a href="https://www.mybandstonight.com/venue-map" target="_top" class="flex-1 flex flex-col items-center justify-center text-blue-600 hover:bg-blue-50 py-2 rounded-xl transition-all duration-300">
                    <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg>
                    <span class="text-xs font-bold text-center">Venue Map</span>
                </a>
                <a href="https://www.mybandstonight.com/home" target="_top" class="flex-1 flex flex-col items-center justify-center text-blue-600 hover:bg-blue-50 py-2 rounded-xl transition-all duration-300">
                    <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 016 0v8.25a3 3 0 01-3 3z" /></svg>
                    <span class="text-xs font-bold text-center">My Bands Tonight</span>
                </a>
                <a href="https://www.mybandstonight.com/newsletter" target="_top" class="flex-1 flex flex-col items-center justify-center text-blue-600 hover:bg-blue-50 py-2 rounded-xl transition-all duration-300">
                    <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    <span class="text-xs font-bold text-center">Newsletter</span>
                </a>
                <a href="https://www.mybandstonight.com/band-reviews" target="_top" class="flex-1 flex flex-col items-center justify-center text-blue-600 hover:bg-blue-50 py-2 rounded-xl transition-all duration-300">
                    <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" /></svg>
                    <span class="text-xs font-bold text-center">Leave a Review</span>
                </a>
            </div>
            <div class="relative">
                <button id="menu-button" class="block w-12 h-12 relative rounded-full">
                    <img class="w-12 h-12 rounded-full object-cover" src="https://i.imghippo.com/files/IqE3821yyM.png" alt="Menu Button">
                    <div class="absolute inset-0 bg-black bg-opacity-20 rounded-full flex items-center justify-center">
                        <div id="hamburger-icon" class="space-y-1.5">
                            <span class="hamburger-line line-1 block w-6 h-[3px] bg-white rounded-full"></span>
                            <span class="hamburger-line line-2 block w-6 h-[3px] bg-white rounded-full"></span>
                            <span class="hamburger-line line-3 block w-6 h-[3px] bg-white rounded-full"></span>
                        </div>
                    </div>
                </button>
                <div id="contact-menu" class="hidden absolute bottom-full right-0 mb-4 w-48 bg-white border border-gray-200 rounded-lg shadow-lg">
                    <a href="mailto:info@mybandstonight.com" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200 rounded-t-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                        <span>Contact Us</span>
                    </a>
                    <a href="https://www.mybandstonight.com/admin-panel" target="_top" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200 rounded-b-lg border-t border-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3 text-gray-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008h-.008v-.008z" />
                        </svg>
                        <span>Admin</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="loadingOverlay">
    <div class="loading-image-container">
        <img src="https://i.imghippo.com/files/ofc9438IXE.png" alt="Loading" class="loading-image">
    </div>
    <div class="loading-text">Loading Page...</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- API Keys & URLs ---
        const GIG_ENTRY_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwis1FuC0oaT36VeTcsTixxfup2Nhf3pB_U2-Hnl3HGTw0ms5pZdC9h5pPD6UDpe_nv/exec";

        // --- State Variables ---
        const gigForm = document.getElementById('gig-entry-form');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const customAlert = document.getElementById('customAlert');
        let alertTimeout;
        let userIP = null;
        let stagedGigs = [];
        let venueCache = []; // This will hold the FULL venue list for instant local search.

        // --- Custom Alert Function (condensed) ---
        const showCustomAlert = (message, isError = false, duration = 4000) => { clearTimeout(alertTimeout); const alertBox = document.createElement('div'); alertBox.className = 'custom-alert-box'; alertBox.textContent = message; if (isError) { alertBox.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)'; } customAlert.innerHTML = ''; customAlert.appendChild(alertBox); alertTimeout = setTimeout(() => { alertBox.classList.add('fade-out'); alertBox.addEventListener('animationend', () => customAlert.contains(alertBox) && customAlert.removeChild(alertBox)); }, duration); };
        
        // --- IP Geolocation Logic ---
        const getUserIP = () => { fetch('https://api.ipify.org?format=json').then(response => response.json()).then(data => { userIP = data.ip; }).catch(error => { console.warn('Could not fetch IP address.', error); }); };

        // --- Gig List Management (condensed)---
        const addToListBtn = document.getElementById('add-gig-to-list-btn'); const submitAllBtn = document.getElementById('submit-all-btn'); const clearListBtn = document.getElementById('clear-list-btn'); const stagedGigsContainer = document.getElementById('staged-gigs-container'); const stagedGigsList = document.getElementById('staged-gigs-list');
        const renderStagedGigs = () => { stagedGigsList.innerHTML = ''; if (stagedGigs.length === 0) { stagedGigsContainer.classList.add('hidden'); return; } stagedGigsContainer.classList.remove('hidden'); submitAllBtn.textContent = `Submit ${stagedGigs.length} Gig(s)`; stagedGigs.forEach((gig, index) => { const gigElement = document.createElement('div'); gigElement.className = 'bg-slate-50 p-4 rounded-lg border border-slate-200 flex items-center justify-between'; gigElement.innerHTML = `<div><p class="font-semibold text-slate-800">${gig['Venue Name']}</p><p class="text-sm text-slate-600">${gig['Address']}</p><p class="text-sm text-slate-500 mt-1">${gig['Date']} at ${gig['Time']}</p></div><button data-index="${index}" class="remove-gig-btn text-red-500 hover:text-red-700 transition-colors p-2"><i class="fas fa-trash-alt fa-lg"></i></button>`; stagedGigsList.appendChild(gigElement); }); };
        const partialResetForm = () => { const keepVenue = document.getElementById('keep-venue-info').checked; const keepTime = document.getElementById('keep-time').checked; if (!keepVenue) { ['venue-name', 'venue-address', 'venue-website', 'venue-phone', 'venue-email'].forEach(id => document.getElementById(id).value = ''); } if (!keepTime) { document.getElementById('gig-time').value = ''; document.getElementById('gig-time-display').textContent = 'Select a time...'; } document.getElementById('gig-date').value = ''; document.getElementById('gig-date-display').textContent = 'Select a date...'; gigForm.querySelectorAll('[required]').forEach(field => { if (field.id !== 'band-name') { const targetEl = document.getElementById(`${field.id}-display`) || field; targetEl.classList.remove('border-red-500', 'ring-red-500'); } }); if (!keepVenue) document.getElementById('venue-name').focus(); else document.getElementById('gig-date-display').focus(); };
        addToListBtn.addEventListener('click', () => { let firstInvalidField = null, isValid = true; gigForm.querySelectorAll('[required]').forEach(field => { const targetEl = document.getElementById(`${field.id}-display`) || field; if (!field.value.trim()) { targetEl.classList.add('border-red-500', 'ring-red-500'); if (!firstInvalidField) firstInvalidField = targetEl; isValid = false; } else { targetEl.classList.remove('border-red-500', 'ring-red-500'); } }); if (!isValid) { showCustomAlert('Please fill out all required fields.', true); firstInvalidField.focus(); return; } const gigData = { 'Name': document.getElementById('band-name').value.trim(), 'Band Website': document.getElementById('band-website').value.trim(), 'Band Email': document.getElementById('band-email').value.trim(), 'Venue Name': document.getElementById('venue-name').value.trim(), 'Address': document.getElementById('venue-address').value.trim(), 'Venue Website': document.getElementById('venue-website').value.trim(), 'Venue Phone Number': document.getElementById('venue-phone').value.trim(), 'Venue Email': document.getElementById('venue-email').value.trim(), 'Date': document.getElementById('gig-date').value, 'Time': document.getElementById('gig-time').value }; stagedGigs.push(gigData); showCustomAlert('Gig added to the list!'); renderStagedGigs(); partialResetForm(); });
        stagedGigsList.addEventListener('click', (e) => { const removeBtn = e.target.closest('.remove-gig-btn'); if (removeBtn) { stagedGigs.splice(parseInt(removeBtn.dataset.index, 10), 1); renderStagedGigs(); showCustomAlert('Gig removed from the list.'); } });
        submitAllBtn.addEventListener('click', () => { if (stagedGigs.length === 0) return showCustomAlert('There are no gigs in the list to submit.', true); submitAllBtn.disabled = true; submitAllBtn.textContent = 'Submitting...'; fetch(GIG_ENTRY_SCRIPT_URL, { method: 'POST', body: JSON.stringify(stagedGigs), headers: { 'Content-Type': 'text/plain;charset=utf-8' } }).then(res => res.ok ? res.json() : Promise.reject(`Network error: ${res.statusText}`)).then(data => { if (data.result !== 'success') throw new Error(data.error || 'Unknown script error.'); gigForm.reset(); partialResetForm(); stagedGigs = []; renderStagedGigs(); showCustomAlert(`${data.count || 'All'} gigs added successfully!`); }).catch(error => { showCustomAlert(`Error: ${error.message}`, true); }).finally(() => { submitAllBtn.disabled = false; renderStagedGigs(); }); });
        clearListBtn.addEventListener('click', () => { if (stagedGigs.length > 0) { stagedGigs = []; renderStagedGigs(); showCustomAlert('List cleared.', false, 2000); } });

        // --- Intelligent search logic (condensed) ---
        const normalizeString = (str) => !str ? '' : str.toLowerCase().replace(/\b(the|a|an)\b/g, '').replace(/[\s\W_]+/g, '');
        const venueInput = document.getElementById('venue-name');
        const venueSuggestionsContainer = document.getElementById('venue-suggestions');
        const fetchVenues = () => { fetch(`${GIG_ENTRY_SCRIPT_URL}?action=getVenues`).then(res => res.ok ? res.json() : Promise.reject('Failed to fetch venues.')).then(json => { if (json.result === 'success') { venueCache = json.data; console.log(`✅ Instantly ready with ${venueCache.length} cached venues.`); } else { throw new Error(json.error); } }).catch(error => console.error('❌ Could not fetch venue list:', error)); };
        venueInput.addEventListener('input', () => { const query = venueInput.value; venueSuggestionsContainer.innerHTML = ''; if (query.length < 2 || venueCache.length === 0) { venueSuggestionsContainer.classList.add('hidden'); return; } const normalizedQuery = normalizeString(query); const filteredVenues = venueCache.filter(venue => normalizeString(venue.name).includes(normalizedQuery)).slice(0, 7); if (filteredVenues.length > 0) { filteredVenues.forEach(venue => { const suggestionDiv = document.createElement('div'); suggestionDiv.innerHTML = `<div class="font-medium text-slate-800">${venue.name}</div><div class="text-sm text-slate-500">${venue.address}</div>`; suggestionDiv.className = 'px-4 py-2 hover:bg-slate-100 cursor-pointer border-b border-slate-100 last:border-b-0'; suggestionDiv.addEventListener('click', () => { document.getElementById('venue-name').value = venue.name || ''; document.getElementById('venue-address').value = venue.address || ''; document.getElementById('venue-website').value = venue.website || ''; document.getElementById('venue-phone').value = venue.phone || ''; document.getElementById('venue-email').value = venue.email || ''; venueSuggestionsContainer.classList.add('hidden'); document.getElementById('gig-date-display').focus(); }); venueSuggestionsContainer.appendChild(suggestionDiv); }); venueSuggestionsContainer.classList.remove('hidden'); } else { venueSuggestionsContainer.classList.add('hidden'); } });
        document.addEventListener('click', (e) => { if (!document.getElementById('venue-container').contains(e.target)) venueSuggestionsContainer.classList.add('hidden'); });

        // --- MODIFIED: Address Autocomplete with Skeleton Loader and 20ms Delay ---
        const addressInput = document.getElementById('venue-address');
        const addressSuggestionsContainer = document.getElementById('address-suggestions');
        let addressDebounceTimer;
        let addressAbortController;

        addressInput.addEventListener('input', () => {
            clearTimeout(addressDebounceTimer);
            const query = addressInput.value;
            if (addressAbortController) { addressAbortController.abort(); }
            
            if (query.length < 3) {
                addressSuggestionsContainer.classList.add('hidden');
                return;
            }

            addressDebounceTimer = setTimeout(() => {
                // Show skeleton loader
                addressSuggestionsContainer.innerHTML = `
                    <div class="skeleton-item"><div class="skeleton-line long"></div><div class="skeleton-line short"></div></div>
                    <div class="skeleton-item"><div class="skeleton-line long"></div><div class="skeleton-line short"></div></div>
                    <div class="skeleton-item"><div class="skeleton-line long"></div><div class="skeleton-line short"></div></div>
                `;
                addressSuggestionsContainer.classList.remove('hidden');

                addressAbortController = new AbortController();
                const url = `${GIG_ENTRY_SCRIPT_URL}?action=autocompleteAddress&query=${encodeURIComponent(query)}&ip=${userIP || ''}`;
                
                fetch(url, { signal: addressAbortController.signal })
                    .then(response => response.ok ? response.json() : Promise.reject(`Address lookup failed`))
                    .then(data => {
                        addressSuggestionsContainer.innerHTML = ''; // Clear skeletons
                        if (data.features && data.features.length > 0) {
                            data.features.forEach(feature => {
                                const props = feature.properties;
                                if (props.address_line1 && props.address_line2) {
                                    const suggestionDiv = document.createElement('div');
                                    suggestionDiv.className = 'px-4 py-2 hover:bg-slate-100 cursor-pointer border-b border-slate-100 last:border-b-0';
                                    suggestionDiv.innerHTML = `<div class="font-medium text-slate-800">${props.address_line1}</div><div class="text-sm text-slate-500">${props.address_line2}</div>`;
                                    suggestionDiv.addEventListener('click', () => {
                                        addressInput.value = props.formatted;
                                        addressSuggestionsContainer.classList.add('hidden');
                                    });
                                    addressSuggestionsContainer.appendChild(suggestionDiv);
                                }
                            });
                        }
                        if (addressSuggestionsContainer.childElementCount === 0) {
                            addressSuggestionsContainer.classList.add('hidden');
                        }
                    })
                    .catch(error => {
                        if (error.name !== 'AbortError') {
                            console.error('Address lookup fetch failed:', error);
                            addressSuggestionsContainer.innerHTML = '';
                            addressSuggestionsContainer.classList.add('hidden');
                        }
                    });
            }, 20); // <-- Delay set to 20ms
        });
        
        document.addEventListener('click', (e) => {
            if (!document.getElementById('address-container').contains(e.target)) {
                addressSuggestionsContainer.classList.add('hidden');
            }
        });
        
        // --- Custom Calendar & Time Picker Logic (Condensed) ---
        const calendarModal = document.getElementById('calendar-modal'); const dateDisplay = document.getElementById('gig-date-display'); const dateInput = document.getElementById('gig-date'); const monthYearDisplay = document.getElementById('month-year-display'); const calendarDaysGrid = document.getElementById('calendar-days-grid'); const prevMonthBtn = document.getElementById('prev-month-btn'); const nextMonthBtn = document.getElementById('next-month-btn'); let calendarDate = new Date(); let selectedDate = null;
        const buildCalendar = (year, month) => { calendarDaysGrid.innerHTML = ""; monthYearDisplay.textContent = `${new Date(year, month).toLocaleString("default", { month: "long" })} ${year}`; const firstDay = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month + 1, 0).getDate(); const today = new Date(); for (let i = 0; i < firstDay; i++) { calendarDaysGrid.appendChild(Object.assign(document.createElement("div"), { className: "day empty" })); } for (let day = 1; day <= daysInMonth; day++) { const cell = document.createElement("div"); cell.className = "day"; cell.textContent = day; const cellDate = new Date(year, month, day); if (selectedDate && cellDate.toDateString() === selectedDate.toDateString()) { cell.classList.add("selected"); } if (cellDate.toDateString() === today.toDateString()) { cell.classList.add("today"); } cell.addEventListener('click', () => { selectedDate = cellDate; dateInput.value = selectedDate.toISOString().split('T')[0]; dateDisplay.textContent = selectedDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); dateDisplay.classList.remove('border-red-500', 'ring-red-500'); calendarModal.classList.remove('visible'); }); calendarDaysGrid.appendChild(cell); } };
        dateDisplay.addEventListener('click', () => calendarModal.classList.add('visible')); calendarModal.addEventListener('click', (e) => e.target === calendarModal && calendarModal.classList.remove('visible')); prevMonthBtn.addEventListener('click', () => { calendarDate.setMonth(calendarDate.getMonth() - 1); buildCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); }); nextMonthBtn.addEventListener('click', () => { calendarDate.setMonth(calendarDate.getMonth() + 1); buildCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); });
        const timePickerModal = document.getElementById('time-picker-modal'); const timeDisplay = document.getElementById('gig-time-display'); const timeInput = document.getElementById('gig-time'); const hourInput = document.getElementById('time-hour'); const minuteInput = document.getElementById('time-minute'); const amBtn = document.getElementById('time-am'); const pmBtn = document.getElementById('time-pm'); const setTimeBtn = document.getElementById('set-time-btn'); let selectedHour = null, selectedMinute = null, selectedAmPm = null; const formatTime = (h, m, ampm) => `${String(h)}:${String(m).padStart(2, '0')} ${ampm}`;
        timeDisplay.addEventListener('click', () => { const now = new Date(); hourInput.value = selectedHour !== null ? selectedHour : now.getHours() % 12 || 12; minuteInput.value = selectedMinute !== null ? String(selectedMinute).padStart(2, '0') : String(now.getMinutes()).padStart(2, '0'); const currentAmPm = selectedAmPm !== null ? selectedAmPm : (now.getHours() >= 12 ? 'PM' : 'AM'); if(currentAmPm === 'PM') { pmBtn.classList.add('active'); amBtn.classList.remove('active'); } else { amBtn.classList.add('active'); pmBtn.classList.remove('active'); } timePickerModal.classList.add('visible'); });
        amBtn.addEventListener('click', () => { amBtn.classList.add('active'); pmBtn.classList.remove('active'); }); pmBtn.addEventListener('click', () => { pmBtn.classList.add('active'); amBtn.classList.remove('active'); }); [hourInput, minuteInput].forEach(input => { input.addEventListener('input', () => { let val = parseInt(input.value), min = parseInt(input.min), max = parseInt(input.max); if (val < min) input.value = min; if (val > max) input.value = max; }); });
        setTimeBtn.addEventListener('click', () => { const hour = parseInt(hourInput.value), minute = parseInt(minuteInput.value), ampm = amBtn.classList.contains('active') ? 'AM' : 'PM'; if (isNaN(hour) || isNaN(minute)) { showCustomAlert('Please enter a valid time.', true); return; } selectedHour = hour; selectedMinute = minute; selectedAmPm = ampm; const formattedTime = formatTime(hour, minute, ampm); timeInput.value = formattedTime; timeDisplay.textContent = formattedTime; timeDisplay.classList.remove('border-red-500', 'ring-red-500'); timePickerModal.classList.remove('visible'); });
        timePickerModal.addEventListener('click', (e) => e.target === timePickerModal && timePickerModal.classList.remove('visible'));

        // --- Menu Bar Logic ---
        const menuButton = document.getElementById('menu-button'); const contactMenu = document.getElementById('contact-menu'); const hamburgerIcon = document.getElementById('hamburger-icon');
        menuButton.addEventListener('click', (e) => { e.stopPropagation(); contactMenu.classList.toggle('hidden'); hamburgerIcon.classList.toggle('open'); });
        document.addEventListener('click', (e) => { if (!contactMenu.classList.contains('hidden') && !menuButton.contains(e.target)) { contactMenu.classList.add('hidden'); hamburgerIcon.classList.remove('open'); } });

        // --- App Initialization ---
        const initializeApp = () => {
            getUserIP();
            fetchVenues();
            buildCalendar(calendarDate.getFullYear(), calendarDate.getMonth());
            const minDelayPromise = new Promise(resolve => setTimeout(resolve, 500));
            minDelayPromise.then(() => {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => { loadingOverlay.style.display = "none"; }, 500);
            });
        };
        initializeApp();
    });
</script>
</body>
</html>
